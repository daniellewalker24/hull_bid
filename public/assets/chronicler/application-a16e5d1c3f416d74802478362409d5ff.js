/*
 * imgAreaSelect jQuery plugin
 * version 0.9.10
 *
 * Copyright (c) 2008-2013 Michal Wojciechowski (odyniec.net)
 *
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://odyniec.net/projects/imgareaselect/
 *
 */
!function(e){function t(){return e("<div/>")}var n=Math.abs,i=Math.max,o=Math.min,r=Math.round;e.imgAreaSelect=function(s,a){function l(e){return e+gt.left-vt.left}function c(e){return e+gt.top-vt.top}function d(e){return e-gt.left+vt.left}function u(e){return e-gt.top+vt.top}function h(e){return e.pageX-vt.left}function f(e){return e.pageY-vt.top}function p(e){var t=e||q,n=e||V;return{x1:r(_t.x1*t),y1:r(_t.y1*n),x2:r(_t.x2*t),y2:r(_t.y2*n),width:r(_t.x2*t)-r(_t.x1*t),height:r(_t.y2*n)-r(_t.y1*n)}}function m(e,t,n,i,o){var s=o||q,a=o||V;_t={x1:r(e/s||0),y1:r(t/a||0),x2:r(n/s||0),y2:r(i/a||0)},_t.width=_t.x2-_t.x1,_t.height=_t.y2-_t.y1}function g(){R&&dt.width()&&(gt={left:r(dt.offset().left),top:r(dt.offset().top)},F=dt.innerWidth(),z=dt.innerHeight(),gt.top+=dt.outerHeight()-z>>1,gt.left+=dt.outerWidth()-F>>1,K=r(a.minWidth/q)||0,Y=r(a.minHeight/V)||0,G=r(o(a.maxWidth/q||1<<24,F)),X=r(o(a.maxHeight/V||1<<24,z)),"1.3.2"!=e().jquery||"fixed"!=bt||Ct.getBoundingClientRect||(gt.top+=i(document.body.scrollTop,Ct.scrollTop),gt.left+=i(document.body.scrollLeft,Ct.scrollLeft)),vt=/absolute|relative/.test(W.css("position"))?{left:r(W.offset().left)-W.scrollLeft(),top:r(W.offset().top)-W.scrollTop()}:"fixed"==bt?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0},H=l(0),O=c(0),(_t.x2>F||_t.y2>z)&&k())}function v(t){if(J){switch(ut.css({left:l(_t.x1),top:c(_t.y1)}).add(ht).width(at=_t.width).height(lt=_t.height),ht.add(ft).add(mt).css({left:0,top:0}),ft.width(i(at-ft.outerWidth()+ft.innerWidth(),0)).height(i(lt-ft.outerHeight()+ft.innerHeight(),0)),e(pt[0]).css({left:H,top:O,width:_t.x1,height:z}),e(pt[1]).css({left:H+_t.x1,top:O,width:at,height:_t.y1}),e(pt[2]).css({left:H+_t.x2,top:O,width:F-_t.x2,height:z}),e(pt[3]).css({left:H+_t.x1,top:O+_t.y2,width:at,height:z-_t.y2}),at-=mt.outerWidth(),lt-=mt.outerHeight(),mt.length){case 8:e(mt[4]).css({left:at>>1}),e(mt[5]).css({left:at,top:lt>>1}),e(mt[6]).css({left:at>>1,top:lt}),e(mt[7]).css({top:lt>>1});case 4:mt.slice(1,3).css({left:at}),mt.slice(2,4).css({top:lt})}t!==!1&&(e.imgAreaSelect.onKeyPress!=wt&&e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress),a.keys&&e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=wt)),kt&&2==ft.outerWidth()-ft.innerWidth()&&(ft.css("margin",0),setTimeout(function(){ft.css("margin","auto")},0))}}function y(e){g(),v(e),Z=l(_t.x1),et=c(_t.y1),tt=l(_t.x2),nt=c(_t.y2)}function b(e,t){a.fadeSpeed?e.fadeOut(a.fadeSpeed,t):e.hide()}function _(e){var t=d(h(e))-_t.x1,n=u(f(e))-_t.y1;ct||(g(),ct=!0,ut.one("mouseout",function(){ct=!1})),$="",a.resizable&&(n<=a.resizeMargin?$="n":n>=_t.height-a.resizeMargin&&($="s"),t<=a.resizeMargin?$+="w":t>=_t.width-a.resizeMargin&&($+="e")),ut.css("cursor",$?$+"-resize":a.movable?"move":""),L&&L.toggle()}function C(){e("body").css("cursor",""),(a.autoHide||0==_t.width*_t.height)&&b(ut.add(pt),function(){e(this).hide()}),e(document).unbind("mousemove",S),ut.mousemove(_),a.onSelectEnd(s,p())}function x(t){return 1!=t.which?!1:(g(),$?(e("body").css("cursor",$+"-resize"),Z=l(_t[/w/.test($)?"x2":"x1"]),et=c(_t[/n/.test($)?"y2":"y1"]),e(document).mousemove(S).one("mouseup",C),ut.unbind("mousemove",_)):a.movable?(j=H+_t.x1-h(t),U=O+_t.y1-f(t),ut.unbind("mousemove",_),e(document).mousemove(E).one("mouseup",function(){a.onSelectEnd(s,p()),e(document).unbind("mousemove",E),ut.mousemove(_)})):dt.mousedown(t),!1)}function w(e){Q&&(e?(tt=i(H,o(H+F,Z+n(nt-et)*Q*(tt>Z||-1))),nt=r(i(O,o(O+z,et+n(tt-Z)/Q*(nt>et||-1)))),tt=r(tt)):(nt=i(O,o(O+z,et+n(tt-Z)/Q*(nt>et||-1))),tt=r(i(H,o(H+F,Z+n(nt-et)*Q*(tt>Z||-1)))),nt=r(nt)))}function k(){Z=o(Z,H+F),et=o(et,O+z),n(tt-Z)<K&&(tt=Z-K*(Z>tt||-1),H>tt?Z=H+K:tt>H+F&&(Z=H+F-K)),n(nt-et)<Y&&(nt=et-Y*(et>nt||-1),O>nt?et=O+Y:nt>O+z&&(et=O+z-Y)),tt=i(H,o(tt,H+F)),nt=i(O,o(nt,O+z)),w(n(tt-Z)<n(nt-et)*Q),n(tt-Z)>G&&(tt=Z-G*(Z>tt||-1),w()),n(nt-et)>X&&(nt=et-X*(et>nt||-1),w(!0)),_t={x1:d(o(Z,tt)),x2:d(i(Z,tt)),y1:u(o(et,nt)),y2:u(i(et,nt)),width:n(tt-Z),height:n(nt-et)},v(),a.onSelectChange(s,p())}function S(e){return tt=/w|e|^$/.test($)||Q?h(e):l(_t.x2),nt=/n|s|^$/.test($)||Q?f(e):c(_t.y2),k(),!1}function T(t,n){tt=(Z=t)+_t.width,nt=(et=n)+_t.height,e.extend(_t,{x1:d(Z),y1:u(et),x2:d(tt),y2:u(nt)}),v(),a.onSelectChange(s,p())}function E(e){return Z=i(H,o(j+h(e),H+F-_t.width)),et=i(O,o(U+f(e),O+z-_t.height)),T(Z,et),e.preventDefault(),!1}function N(){e(document).unbind("mousemove",N),g(),tt=Z,nt=et,k(),$="",pt.is(":visible")||ut.add(pt).hide().fadeIn(a.fadeSpeed||0),J=!0,e(document).unbind("mouseup",A).mousemove(S).one("mouseup",C),ut.unbind("mousemove",_),a.onSelectStart(s,p())}function A(){e(document).unbind("mousemove",N).unbind("mouseup",A),b(ut.add(pt)),m(d(Z),u(et),d(Z),u(et)),this instanceof e.imgAreaSelect||(a.onSelectChange(s,p()),a.onSelectEnd(s,p()))}function D(t){return 1!=t.which||pt.is(":animated")?!1:(g(),j=Z=h(t),U=et=f(t),e(document).mousemove(N).mouseup(A),!1)}function M(){y(!1)}function I(){R=!0,P(a=e.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},a)),ut.add(pt).css({visibility:""}),a.show&&(J=!0,g(),v(),ut.add(pt).hide().fadeIn(a.fadeSpeed||0)),setTimeout(function(){a.onInit(s,p())},0)}function B(e,t){for(var n in t)void 0!==a[n]&&e.css(t[n],a[n])}function P(n){if(n.parent&&(W=e(n.parent)).append(ut.add(pt)),e.extend(a,n),g(),null!=n.handles){for(mt.remove(),mt=e([]),rt=n.handles?"corners"==n.handles?4:8:0;rt--;)mt=mt.add(t());mt.addClass(a.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:yt+1||1}),!parseInt(mt.css("width"))>=0&&mt.width(5).height(5),(st=a.borderWidth)&&mt.css({borderWidth:st,borderStyle:"solid"}),B(mt,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}for(q=a.imageWidth/F||1,V=a.imageHeight/z||1,null!=n.x1&&(m(n.x1,n.y1,n.x2,n.y2),n.show=!n.hide),n.keys&&(a.keys=e.extend({shift:1,ctrl:"resize"},n.keys)),pt.addClass(a.classPrefix+"-outer"),ht.addClass(a.classPrefix+"-selection"),rt=0;rt++<4;)e(ft[rt-1]).addClass(a.classPrefix+"-border"+rt);B(ht,{selectionColor:"background-color",selectionOpacity:"opacity"}),B(ft,{borderOpacity:"opacity",borderWidth:"border-width"}),B(pt,{outerColor:"background-color",outerOpacity:"opacity"}),(st=a.borderColor1)&&e(ft[0]).css({borderStyle:"solid",borderColor:st}),(st=a.borderColor2)&&e(ft[1]).css({borderStyle:"dashed",borderColor:st}),ut.append(ht.add(ft).add(L)).append(mt),kt&&((st=(pt.css("filter")||"").match(/opacity=(\d+)/))&&pt.css("opacity",st[1]/100),(st=(ft.css("filter")||"").match(/opacity=(\d+)/))&&ft.css("opacity",st[1]/100)),n.hide?b(ut.add(pt)):n.show&&R&&(J=!0,ut.add(pt).fadeIn(a.fadeSpeed||0),y()),Q=(ot=(a.aspectRatio||"").split(/:/))[0]/ot[1],dt.add(pt).unbind("mousedown",D),a.disable||a.enable===!1?(ut.unbind("mousemove",_).unbind("mousedown",x),e(window).unbind("resize",M)):((a.enable||a.disable===!1)&&((a.resizable||a.movable)&&ut.mousemove(_).mousedown(x),e(window).resize(M)),a.persistent||dt.add(pt).mousedown(D)),a.enable=a.disable=void 0}var R,L,H,O,F,z,W,j,U,q,V,$,K,Y,G,X,Q,J,Z,et,tt,nt,it,ot,rt,st,at,lt,ct,dt=e(s),ut=t(),ht=t(),ft=t().add(t()).add(t()).add(t()),pt=t().add(t()).add(t()).add(t()),mt=e([]),gt={left:0,top:0},vt={left:0,top:0},yt=0,bt="absolute",_t={x1:0,y1:0,x2:0,y2:0,width:0,height:0},Ct=document.documentElement,xt=navigator.userAgent,wt=function(e){var t,n,r=a.keys,s=e.keyCode;if(t=isNaN(r.alt)||!e.altKey&&!e.originalEvent.altKey?!isNaN(r.ctrl)&&e.ctrlKey?r.ctrl:!isNaN(r.shift)&&e.shiftKey?r.shift:isNaN(r.arrows)?10:r.arrows:r.alt,"resize"==r.arrows||"resize"==r.shift&&e.shiftKey||"resize"==r.ctrl&&e.ctrlKey||"resize"==r.alt&&(e.altKey||e.originalEvent.altKey)){switch(s){case 37:t=-t;case 39:n=i(Z,tt),Z=o(Z,tt),tt=i(n+t,Z),w();break;case 38:t=-t;case 40:n=i(et,nt),et=o(et,nt),nt=i(n+t,et),w(!0);break;default:return}k()}else switch(Z=o(Z,tt),et=o(et,nt),s){case 37:T(i(Z-t,H),et);break;case 38:T(Z,i(et-t,O));break;case 39:T(Z+o(t,F-d(tt)),et);break;case 40:T(Z,et+o(t,z-u(nt)));break;default:return}return!1};this.remove=function(){P({disable:!0}),ut.add(pt).remove()},this.getOptions=function(){return a},this.setOptions=P,this.getSelection=p,this.setSelection=m,this.cancelSelection=A,this.update=y;var kt=(/msie ([\w.]+)/i.exec(xt)||[])[1],St=/opera/i.test(xt),Tt=/webkit/i.test(xt)&&!/chrome/i.test(xt);for(it=dt;it.length;)yt=i(yt,isNaN(it.css("z-index"))?yt:it.css("z-index")),"fixed"==it.css("position")&&(bt="fixed"),it=it.parent(":not(body)");yt=a.zIndex||yt,kt&&dt.attr("unselectable","on"),e.imgAreaSelect.keyPress=kt||Tt?"keydown":"keypress",St&&(L=t().css({width:"100%",height:"100%",position:"absolute",zIndex:yt+2||2})),ut.add(pt).css({visibility:"hidden",position:bt,overflow:"hidden",zIndex:yt||"0"}),ut.css({zIndex:yt+2||2}),ht.add(ft).css({position:"absolute",fontSize:0}),s.complete||"complete"==s.readyState||!dt.is("img")?I():dt.one("load",I),!R&&kt&&kt>=7&&(s.src=s.src)},e.fn.imgAreaSelect=function(t){return t=t||{},this.each(function(){e(this).data("imgAreaSelect")?t.remove?(e(this).data("imgAreaSelect").remove(),e(this).removeData("imgAreaSelect")):e(this).data("imgAreaSelect").setOptions(t):t.remove||(void 0===t.enable&&void 0===t.disable&&(t.enable=!0),e(this).data("imgAreaSelect",new e.imgAreaSelect(this,t)))}),t.instance?e(this).data("imgAreaSelect"):this}}(jQuery),jQuery.fn.farbtastic=function(e){return $.farbtastic(this,e),this},jQuery.farbtastic=function(e,t){var e=$(e).get(0);return e.farbtastic||(e.farbtastic=new jQuery._farbtastic(e,t))},jQuery._farbtastic=function(e,t){var n=this;$(e).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var i=$(".farbtastic",e);n.wheel=$(".wheel",e).get(0),n.radius=84,n.square=100,n.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",i).each(function(){if("none"!=this.currentStyle.backgroundImage){var e=this.currentStyle.backgroundImage;e=this.currentStyle.backgroundImage.substring(5,e.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+e+"')"})}}),n.linkTo=function(e){return"object"==typeof n.callback&&$(n.callback).unbind("keyup",n.updateValue),n.color=null,"function"==typeof e?n.callback=e:("object"==typeof e||"string"==typeof e)&&(n.callback=$(e),n.callback.bind("keyup",n.updateValue),n.callback.get(0).value&&n.setColor(n.callback.get(0).value)),this},n.updateValue=function(){this.value&&this.value!=n.color&&n.setColor(this.value)},n.setColor=function(e){var t=n.unpack(e);return n.color!=e&&t&&(n.color=e,n.rgb=t,n.hsl=n.RGBToHSL(n.rgb),n.updateDisplay()),this},n.setHSL=function(e){return n.hsl=e,n.rgb=n.HSLToRGB(e),n.color=n.pack(n.rgb),n.updateDisplay(),this},n.widgetCoords=function(e){var t,i,o=e.target||e.srcElement,r=n.wheel;if("undefined"!=typeof e.offsetX){for(var s={x:e.offsetX,y:e.offsetY},a=o;a;)a.mouseX=s.x,a.mouseY=s.y,s.x+=a.offsetLeft,s.y+=a.offsetTop,a=a.offsetParent;for(var a=r,l={x:0,y:0};a;){if("undefined"!=typeof a.mouseX){t=a.mouseX-l.x,i=a.mouseY-l.y;break}l.x+=a.offsetLeft,l.y+=a.offsetTop,a=a.offsetParent}for(a=o;a;)a.mouseX=void 0,a.mouseY=void 0,a=a.offsetParent}else{var s=n.absolutePosition(r);t=(e.pageX||0*(e.clientX+$("html").get(0).scrollLeft))-s.x,i=(e.pageY||0*(e.clientY+$("html").get(0).scrollTop))-s.y}return{x:t-n.width/2,y:i-n.width/2}},n.mousedown=function(e){document.dragging||($(document).bind("mousemove",n.mousemove).bind("mouseup",n.mouseup),document.dragging=!0);var t=n.widgetCoords(e);return n.circleDrag=2*Math.max(Math.abs(t.x),Math.abs(t.y))>n.square,n.mousemove(e),!1},n.mousemove=function(e){var t=n.widgetCoords(e);if(n.circleDrag){var i=Math.atan2(t.x,-t.y)/6.28;0>i&&(i+=1),n.setHSL([i,n.hsl[1],n.hsl[2]])}else{var o=Math.max(0,Math.min(1,-(t.x/n.square)+.5)),r=Math.max(0,Math.min(1,-(t.y/n.square)+.5));n.setHSL([n.hsl[0],o,r])}return!1},n.mouseup=function(){$(document).unbind("mousemove",n.mousemove),$(document).unbind("mouseup",n.mouseup),document.dragging=!1},n.updateDisplay=function(){var e=6.28*n.hsl[0];$(".h-marker",i).css({left:Math.round(Math.sin(e)*n.radius+n.width/2)+"px",top:Math.round(-Math.cos(e)*n.radius+n.width/2)+"px"}),$(".sl-marker",i).css({left:Math.round(n.square*(.5-n.hsl[1])+n.width/2)+"px",top:Math.round(n.square*(.5-n.hsl[2])+n.width/2)+"px"}),$(".color",i).css("backgroundColor",n.pack(n.HSLToRGB([n.hsl[0],1,.5]))),"object"==typeof n.callback?($(n.callback).css({backgroundColor:n.color,color:n.hsl[2]>.5?"#000":"#fff"}),$(n.callback).each(function(){this.value&&this.value!=n.color&&(this.value=n.color)})):"function"==typeof n.callback&&n.callback.call(n,n.color)},n.absolutePosition=function(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var i=n.absolutePosition(e.offsetParent);t.x+=i.x,t.y+=i.y}return t},n.pack=function(e){var t=Math.round(255*e[0]),n=Math.round(255*e[1]),i=Math.round(255*e[2]);return"#"+(16>t?"0":"")+t.toString(16)+(16>n?"0":"")+n.toString(16)+(16>i?"0":"")+i.toString(16)},n.unpack=function(e){return 7==e.length?[parseInt("0x"+e.substring(1,3))/255,parseInt("0x"+e.substring(3,5))/255,parseInt("0x"+e.substring(5,7))/255]:4==e.length?[parseInt("0x"+e.substring(1,2))/15,parseInt("0x"+e.substring(2,3))/15,parseInt("0x"+e.substring(3,4))/15]:void 0},n.HSLToRGB=function(e){var t,n,i=e[0],o=e[1],r=e[2];return n=.5>=r?r*(o+1):r+o-r*o,t=2*r-n,[this.hueToRGB(t,n,i+.33333),this.hueToRGB(t,n,i),this.hueToRGB(t,n,i-.33333)]},n.hueToRGB=function(e,t,n){return n=0>n?n+1:n>1?n-1:n,1>6*n?e+6*(t-e)*n:1>2*n?t:2>3*n?e+6*(t-e)*(.66666-n):e},n.RGBToHSL=function(e){var t,n,i,o,r,s,a=e[0],l=e[1],c=e[2];return t=Math.min(a,Math.min(l,c)),n=Math.max(a,Math.max(l,c)),i=n-t,s=(t+n)/2,r=0,s>0&&1>s&&(r=i/(.5>s?2*s:2-2*s)),o=0,i>0&&(n==a&&n!=l&&(o+=(l-c)/i),n==l&&n!=c&&(o+=2+(c-a)/i),n==c&&n!=a&&(o+=4+(a-l)/i),o/=6),[o,r,s]},$("*",i).mousedown(n.mousedown),n.setColor("#000000"),t&&n.linkTo(t)};