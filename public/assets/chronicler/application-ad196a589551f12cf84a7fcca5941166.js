/*
 * imgAreaSelect jQuery plugin
 * version 0.9.10
 *
 * Copyright (c) 2008-2013 Michal Wojciechowski (odyniec.net)
 *
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://odyniec.net/projects/imgareaselect/
 *
 */
(function(e){function t(){return e("<div/>")}var i=Math.abs,n=Math.max,o=Math.min,s=Math.round;e.imgAreaSelect=function(r,a){function l(e){return e+gt.left-vt.left}function c(e){return e+gt.top-vt.top}function u(e){return e-gt.left+vt.left}function d(e){return e-gt.top+vt.top}function h(e){return e.pageX-vt.left}function p(e){return e.pageY-vt.top}function f(e){var t=e||q,i=e||U;return{x1:s(_t.x1*t),y1:s(_t.y1*i),x2:s(_t.x2*t),y2:s(_t.y2*i),width:s(_t.x2*t)-s(_t.x1*t),height:s(_t.y2*i)-s(_t.y1*i)}}function m(e,t,i,n,o){var r=o||q,a=o||U;_t={x1:s(e/r||0),y1:s(t/a||0),x2:s(i/r||0),y2:s(n/a||0)},_t.width=_t.x2-_t.x1,_t.height=_t.y2-_t.y1}function g(){R&&ut.width()&&(gt={left:s(ut.offset().left),top:s(ut.offset().top)},z=ut.innerWidth(),F=ut.innerHeight(),gt.top+=ut.outerHeight()-F>>1,gt.left+=ut.outerWidth()-z>>1,K=s(a.minWidth/q)||0,Y=s(a.minHeight/U)||0,X=s(o(a.maxWidth/q||1<<24,z)),G=s(o(a.maxHeight/U||1<<24,F)),e().jquery!="1.3.2"||"fixed"!=bt||xt.getBoundingClientRect||(gt.top+=n(document.body.scrollTop,xt.scrollTop),gt.left+=n(document.body.scrollLeft,xt.scrollLeft)),vt=/absolute|relative/.test($.css("position"))?{left:s($.offset().left)-$.scrollLeft(),top:s($.offset().top)-$.scrollTop()}:"fixed"==bt?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0},L=l(0),B=c(0),(_t.x2>z||_t.y2>F)&&k())}function v(t){if(Z){switch(dt.css({left:l(_t.x1),top:c(_t.y1)}).add(ht).width(at=_t.width).height(lt=_t.height),ht.add(pt).add(mt).css({left:0,top:0}),pt.width(n(at-pt.outerWidth()+pt.innerWidth(),0)).height(n(lt-pt.outerHeight()+pt.innerHeight(),0)),e(ft[0]).css({left:L,top:B,width:_t.x1,height:F}),e(ft[1]).css({left:L+_t.x1,top:B,width:at,height:_t.y1}),e(ft[2]).css({left:L+_t.x2,top:B,width:z-_t.x2,height:F}),e(ft[3]).css({left:L+_t.x1,top:B+_t.y2,width:at,height:F-_t.y2}),at-=mt.outerWidth(),lt-=mt.outerHeight(),mt.length){case 8:e(mt[4]).css({left:at>>1}),e(mt[5]).css({left:at,top:lt>>1}),e(mt[6]).css({left:at>>1,top:lt}),e(mt[7]).css({top:lt>>1});case 4:mt.slice(1,3).css({left:at}),mt.slice(2,4).css({top:lt})}t!==!1&&(e.imgAreaSelect.onKeyPress!=Ct&&e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress),a.keys&&e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=Ct)),kt&&pt.outerWidth()-pt.innerWidth()==2&&(pt.css("margin",0),setTimeout(function(){pt.css("margin","auto")},0))}}function y(e){g(),v(e),J=l(_t.x1),et=c(_t.y1),tt=l(_t.x2),it=c(_t.y2)}function b(e,t){a.fadeSpeed?e.fadeOut(a.fadeSpeed,t):e.hide()}function _(e){var t=u(h(e))-_t.x1,i=d(p(e))-_t.y1;ct||(g(),ct=!0,dt.one("mouseout",function(){ct=!1})),V="",a.resizable&&(i<=a.resizeMargin?V="n":i>=_t.height-a.resizeMargin&&(V="s"),t<=a.resizeMargin?V+="w":t>=_t.width-a.resizeMargin&&(V+="e")),dt.css("cursor",V?V+"-resize":a.movable?"move":""),O&&O.toggle()}function x(){e("body").css("cursor",""),(a.autoHide||_t.width*_t.height==0)&&b(dt.add(ft),function(){e(this).hide()}),e(document).unbind("mousemove",T),dt.mousemove(_),a.onSelectEnd(r,f())}function w(t){return t.which!=1?!1:(g(),V?(e("body").css("cursor",V+"-resize"),J=l(_t[/w/.test(V)?"x2":"x1"]),et=c(_t[/n/.test(V)?"y2":"y1"]),e(document).mousemove(T).one("mouseup",x),dt.unbind("mousemove",_)):a.movable?(j=L+_t.x1-h(t),W=B+_t.y1-p(t),dt.unbind("mousemove",_),e(document).mousemove(D).one("mouseup",function(){a.onSelectEnd(r,f()),e(document).unbind("mousemove",D),dt.mousemove(_)})):ut.mousedown(t),!1)}function C(e){Q&&(e?(tt=n(L,o(L+z,J+i(it-et)*Q*(tt>J||-1))),it=s(n(B,o(B+F,et+i(tt-J)/Q*(it>et||-1)))),tt=s(tt)):(it=n(B,o(B+F,et+i(tt-J)/Q*(it>et||-1))),tt=s(n(L,o(L+z,J+i(it-et)*Q*(tt>J||-1)))),it=s(it)))}function k(){J=o(J,L+z),et=o(et,B+F),i(tt-J)<K&&(tt=J-K*(J>tt||-1),L>tt?J=L+K:tt>L+z&&(J=L+z-K)),i(it-et)<Y&&(it=et-Y*(et>it||-1),B>it?et=B+Y:it>B+F&&(et=B+F-Y)),tt=n(L,o(tt,L+z)),it=n(B,o(it,B+F)),C(i(tt-J)<i(it-et)*Q),i(tt-J)>X&&(tt=J-X*(J>tt||-1),C()),i(it-et)>G&&(it=et-G*(et>it||-1),C(!0)),_t={x1:u(o(J,tt)),x2:u(n(J,tt)),y1:d(o(et,it)),y2:d(n(et,it)),width:i(tt-J),height:i(it-et)},v(),a.onSelectChange(r,f())}function T(e){return tt=/w|e|^$/.test(V)||Q?h(e):l(_t.x2),it=/n|s|^$/.test(V)||Q?p(e):c(_t.y2),k(),!1}function S(t,i){tt=(J=t)+_t.width,it=(et=i)+_t.height,e.extend(_t,{x1:u(J),y1:d(et),x2:u(tt),y2:d(it)}),v(),a.onSelectChange(r,f())}function D(e){return J=n(L,o(j+h(e),L+z-_t.width)),et=n(B,o(W+p(e),B+F-_t.height)),S(J,et),e.preventDefault(),!1}function E(){e(document).unbind("mousemove",E),g(),tt=J,it=et,k(),V="",ft.is(":visible")||dt.add(ft).hide().fadeIn(a.fadeSpeed||0),Z=!0,e(document).unbind("mouseup",N).mousemove(T).one("mouseup",x),dt.unbind("mousemove",_),a.onSelectStart(r,f())}function N(){e(document).unbind("mousemove",E).unbind("mouseup",N),b(dt.add(ft)),m(u(J),d(et),u(J),d(et)),this instanceof e.imgAreaSelect||(a.onSelectChange(r,f()),a.onSelectEnd(r,f()))}function M(t){return t.which!=1||ft.is(":animated")?!1:(g(),j=J=h(t),W=et=p(t),e(document).mousemove(E).mouseup(N),!1)}function A(){y(!1)}function I(){R=!0,H(a=e.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},a)),dt.add(ft).css({visibility:""}),a.show&&(Z=!0,g(),v(),dt.add(ft).hide().fadeIn(a.fadeSpeed||0)),setTimeout(function(){a.onInit(r,f())},0)}function P(e,t){for(var i in t)a[i]!==void 0&&e.css(t[i],a[i])}function H(i){if(i.parent&&($=e(i.parent)).append(dt.add(ft)),e.extend(a,i),g(),i.handles!=null){for(mt.remove(),mt=e([]),st=i.handles?i.handles=="corners"?4:8:0;st--;)mt=mt.add(t());mt.addClass(a.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:yt+1||1}),!parseInt(mt.css("width"))>=0&&mt.width(5).height(5),(rt=a.borderWidth)&&mt.css({borderWidth:rt,borderStyle:"solid"}),P(mt,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}for(q=a.imageWidth/z||1,U=a.imageHeight/F||1,i.x1!=null&&(m(i.x1,i.y1,i.x2,i.y2),i.show=!i.hide),i.keys&&(a.keys=e.extend({shift:1,ctrl:"resize"},i.keys)),ft.addClass(a.classPrefix+"-outer"),ht.addClass(a.classPrefix+"-selection"),st=0;st++<4;)e(pt[st-1]).addClass(a.classPrefix+"-border"+st);P(ht,{selectionColor:"background-color",selectionOpacity:"opacity"}),P(pt,{borderOpacity:"opacity",borderWidth:"border-width"}),P(ft,{outerColor:"background-color",outerOpacity:"opacity"}),(rt=a.borderColor1)&&e(pt[0]).css({borderStyle:"solid",borderColor:rt}),(rt=a.borderColor2)&&e(pt[1]).css({borderStyle:"dashed",borderColor:rt}),dt.append(ht.add(pt).add(O)).append(mt),kt&&((rt=(ft.css("filter")||"").match(/opacity=(\d+)/))&&ft.css("opacity",rt[1]/100),(rt=(pt.css("filter")||"").match(/opacity=(\d+)/))&&pt.css("opacity",rt[1]/100)),i.hide?b(dt.add(ft)):i.show&&R&&(Z=!0,dt.add(ft).fadeIn(a.fadeSpeed||0),y()),Q=(ot=(a.aspectRatio||"").split(/:/))[0]/ot[1],ut.add(ft).unbind("mousedown",M),a.disable||a.enable===!1?(dt.unbind("mousemove",_).unbind("mousedown",w),e(window).unbind("resize",A)):((a.enable||a.disable===!1)&&((a.resizable||a.movable)&&dt.mousemove(_).mousedown(w),e(window).resize(A)),a.persistent||ut.add(ft).mousedown(M)),a.enable=a.disable=void 0}var R,O,L,B,z,F,$,j,W,q,U,V,K,Y,X,G,Q,Z,J,et,tt,it,nt,ot,st,rt,at,lt,ct,ut=e(r),dt=t(),ht=t(),pt=t().add(t()).add(t()).add(t()),ft=t().add(t()).add(t()).add(t()),mt=e([]),gt={left:0,top:0},vt={left:0,top:0},yt=0,bt="absolute",_t={x1:0,y1:0,x2:0,y2:0,width:0,height:0},xt=document.documentElement,wt=navigator.userAgent,Ct=function(e){var t,i,s=a.keys,r=e.keyCode;if(t=isNaN(s.alt)||!e.altKey&&!e.originalEvent.altKey?!isNaN(s.ctrl)&&e.ctrlKey?s.ctrl:!isNaN(s.shift)&&e.shiftKey?s.shift:isNaN(s.arrows)?10:s.arrows:s.alt,s.arrows=="resize"||s.shift=="resize"&&e.shiftKey||s.ctrl=="resize"&&e.ctrlKey||s.alt=="resize"&&(e.altKey||e.originalEvent.altKey)){switch(r){case 37:t=-t;case 39:i=n(J,tt),J=o(J,tt),tt=n(i+t,J),C();break;case 38:t=-t;case 40:i=n(et,it),et=o(et,it),it=n(i+t,et),C(!0);break;default:return}k()}else switch(J=o(J,tt),et=o(et,it),r){case 37:S(n(J-t,L),et);break;case 38:S(J,n(et-t,B));break;case 39:S(J+o(t,z-u(tt)),et);break;case 40:S(J,et+o(t,F-d(it)));break;default:return}return!1};this.remove=function(){H({disable:!0}),dt.add(ft).remove()},this.getOptions=function(){return a},this.setOptions=H,this.getSelection=f,this.setSelection=m,this.cancelSelection=N,this.update=y;var kt=(/msie ([\w.]+)/i.exec(wt)||[])[1],Tt=/opera/i.test(wt),St=/webkit/i.test(wt)&&!/chrome/i.test(wt);for(nt=ut;nt.length;)yt=n(yt,isNaN(nt.css("z-index"))?yt:nt.css("z-index")),nt.css("position")=="fixed"&&(bt="fixed"),nt=nt.parent(":not(body)");yt=a.zIndex||yt,kt&&ut.attr("unselectable","on"),e.imgAreaSelect.keyPress=kt||St?"keydown":"keypress",Tt&&(O=t().css({width:"100%",height:"100%",position:"absolute",zIndex:yt+2||2})),dt.add(ft).css({visibility:"hidden",position:bt,overflow:"hidden",zIndex:yt||"0"}),dt.css({zIndex:yt+2||2}),ht.add(pt).css({position:"absolute",fontSize:0}),r.complete||r.readyState=="complete"||!ut.is("img")?I():ut.one("load",I),!R&&kt&&kt>=7&&(r.src=r.src)},e.fn.imgAreaSelect=function(t){return t=t||{},this.each(function(){e(this).data("imgAreaSelect")?t.remove?(e(this).data("imgAreaSelect").remove(),e(this).removeData("imgAreaSelect")):e(this).data("imgAreaSelect").setOptions(t):t.remove||(t.enable===void 0&&t.disable===void 0&&(t.enable=!0),e(this).data("imgAreaSelect",new e.imgAreaSelect(this,t)))}),t.instance?e(this).data("imgAreaSelect"):this}})(jQuery),jQuery.fn.farbtastic=function(e){return $.farbtastic(this,e),this},jQuery.farbtastic=function(e,t){var e=$(e).get(0);return e.farbtastic||(e.farbtastic=new jQuery._farbtastic(e,t))},jQuery._farbtastic=function(e,t){var i=this;$(e).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var n=$(".farbtastic",e);i.wheel=$(".wheel",e).get(0),i.radius=84,i.square=100,i.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",n).each(function(){if(this.currentStyle.backgroundImage!="none"){var e=this.currentStyle.backgroundImage;e=this.currentStyle.backgroundImage.substring(5,e.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+e+"')"})}}),i.linkTo=function(e){return typeof i.callback=="object"&&$(i.callback).unbind("keyup",i.updateValue),i.color=null,"function"==typeof e?i.callback=e:("object"==typeof e||"string"==typeof e)&&(i.callback=$(e),i.callback.bind("keyup",i.updateValue),i.callback.get(0).value&&i.setColor(i.callback.get(0).value)),this},i.updateValue=function(){this.value&&this.value!=i.color&&i.setColor(this.value)},i.setColor=function(e){var t=i.unpack(e);return i.color!=e&&t&&(i.color=e,i.rgb=t,i.hsl=i.RGBToHSL(i.rgb),i.updateDisplay()),this},i.setHSL=function(e){return i.hsl=e,i.rgb=i.HSLToRGB(e),i.color=i.pack(i.rgb),i.updateDisplay(),this},i.widgetCoords=function(e){var t,n,o=e.target||e.srcElement,s=i.wheel;if(typeof e.offsetX!="undefined"){for(var r={x:e.offsetX,y:e.offsetY},a=o;a;)a.mouseX=r.x,a.mouseY=r.y,r.x+=a.offsetLeft,r.y+=a.offsetTop,a=a.offsetParent;for(var a=s,l={x:0,y:0};a;){if(typeof a.mouseX!="undefined"){t=a.mouseX-l.x,n=a.mouseY-l.y;break}l.x+=a.offsetLeft,l.y+=a.offsetTop,a=a.offsetParent}for(a=o;a;)a.mouseX=void 0,a.mouseY=void 0,a=a.offsetParent}else{var r=i.absolutePosition(s);t=(e.pageX||0*(e.clientX+$("html").get(0).scrollLeft))-r.x,n=(e.pageY||0*(e.clientY+$("html").get(0).scrollTop))-r.y}return{x:t-i.width/2,y:n-i.width/2}},i.mousedown=function(e){document.dragging||($(document).bind("mousemove",i.mousemove).bind("mouseup",i.mouseup),document.dragging=!0);var t=i.widgetCoords(e);return i.circleDrag=Math.max(Math.abs(t.x),Math.abs(t.y))*2>i.square,i.mousemove(e),!1},i.mousemove=function(e){var t=i.widgetCoords(e);if(i.circleDrag){var n=Math.atan2(t.x,-t.y)/6.28;0>n&&(n+=1),i.setHSL([n,i.hsl[1],i.hsl[2]])}else{var o=Math.max(0,Math.min(1,-(t.x/i.square)+.5)),s=Math.max(0,Math.min(1,-(t.y/i.square)+.5));i.setHSL([i.hsl[0],o,s])}return!1},i.mouseup=function(){$(document).unbind("mousemove",i.mousemove),$(document).unbind("mouseup",i.mouseup),document.dragging=!1},i.updateDisplay=function(){var e=i.hsl[0]*6.28;$(".h-marker",n).css({left:Math.round(Math.sin(e)*i.radius+i.width/2)+"px",top:Math.round(-Math.cos(e)*i.radius+i.width/2)+"px"}),$(".sl-marker",n).css({left:Math.round(i.square*(.5-i.hsl[1])+i.width/2)+"px",top:Math.round(i.square*(.5-i.hsl[2])+i.width/2)+"px"}),$(".color",n).css("backgroundColor",i.pack(i.HSLToRGB([i.hsl[0],1,.5]))),typeof i.callback=="object"?($(i.callback).css({backgroundColor:i.color,color:i.hsl[2]>.5?"#000":"#fff"}),$(i.callback).each(function(){this.value&&this.value!=i.color&&(this.value=i.color)})):typeof i.callback=="function"&&i.callback.call(i,i.color)},i.absolutePosition=function(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var n=i.absolutePosition(e.offsetParent);t.x+=n.x,t.y+=n.y}return t},i.pack=function(e){var t=Math.round(e[0]*255),i=Math.round(e[1]*255),n=Math.round(e[2]*255);return"#"+(16>t?"0":"")+t.toString(16)+(16>i?"0":"")+i.toString(16)+(16>n?"0":"")+n.toString(16)},i.unpack=function(e){return e.length==7?[parseInt("0x"+e.substring(1,3))/255,parseInt("0x"+e.substring(3,5))/255,parseInt("0x"+e.substring(5,7))/255]:e.length==4?[parseInt("0x"+e.substring(1,2))/15,parseInt("0x"+e.substring(2,3))/15,parseInt("0x"+e.substring(3,4))/15]:void 0},i.HSLToRGB=function(e){var t,i,n=e[0],o=e[1],s=e[2];return i=.5>=s?s*(o+1):s+o-s*o,t=2*s-i,[this.hueToRGB(t,i,n+.33333),this.hueToRGB(t,i,n),this.hueToRGB(t,i,n-.33333)]},i.hueToRGB=function(e,t,i){return i=0>i?i+1:i>1?i-1:i,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(.66666-i):e},i.RGBToHSL=function(e){var t,i,n,o,s,r,a=e[0],l=e[1],c=e[2];return t=Math.min(a,Math.min(l,c)),i=Math.max(a,Math.max(l,c)),n=i-t,r=(t+i)/2,s=0,r>0&&1>r&&(s=n/(.5>r?2*r:2-2*r)),o=0,n>0&&(i==a&&i!=l&&(o+=(l-c)/n),i==l&&i!=c&&(o+=2+(c-a)/n),i==c&&i!=a&&(o+=4+(a-l)/n),o/=6),[o,s,r]},$("*",n).mousedown(i.mousedown),i.setColor("#000000"),t&&i.linkTo(t)};