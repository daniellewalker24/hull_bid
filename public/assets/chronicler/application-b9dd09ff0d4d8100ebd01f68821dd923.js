/*
 * imgAreaSelect jQuery plugin
 * version 0.9.10
 *
 * Copyright (c) 2008-2013 Michal Wojciechowski (odyniec.net)
 *
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://odyniec.net/projects/imgareaselect/
 *
 */
(function(e){function s(){return e("<div/>")}var t=Math.abs,n=Math.max,r=Math.min,i=Math.round;e.imgAreaSelect=function(o,u){function G(e){return e+y.left-S.left}function Y(e){return e+y.top-S.top}function Z(e){return e-y.left+S.left}function et(e){return e-y.top+S.top}function tt(e){return e.pageX-S.left}function nt(e){return e.pageY-S.top}function rt(e){var t=e||k,n=e||L;return{x1:i(q.x1*t),y1:i(q.y1*n),x2:i(q.x2*t),y2:i(q.y2*n),width:i(q.x2*t)-i(q.x1*t),height:i(q.y2*n)-i(q.y1*n)}}function it(e,t,n,r,s){var o=s||k,u=s||L;q={x1:i(e/o||0),y1:i(t/u||0),x2:i(n/o||0),y2:i(r/u||0)},q.width=q.x2-q.x1,q.height=q.y2-q.y1}function st(){if(!f||!a.width())return;y={left:i(a.offset().left),top:i(a.offset().top)},b=a.innerWidth(),w=a.innerHeight(),y.top+=a.outerHeight()-w>>1,y.left+=a.outerWidth()-b>>1,O=i(u.minWidth/k)||0,M=i(u.minHeight/L)||0,_=i(r(u.maxWidth/k||1<<24,b)),D=i(r(u.maxHeight/L||1<<24,w)),e().jquery=="1.3.2"&&T=="fixed"&&!R.getBoundingClientRect&&(y.top+=n(document.body.scrollTop,R.scrollTop),y.left+=n(document.body.scrollLeft,R.scrollLeft)),S=/absolute|relative/.test(E.css("position"))?{left:i(E.offset().left)-E.scrollLeft(),top:i(E.offset().top)-E.scrollTop()}:T=="fixed"?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0},m=G(0),g=Y(0),(q.x2>b||q.y2>w)&&pt()}function ot(t){if(!H)return;l.css({left:G(q.x1),top:Y(q.y1)}).add(c).width(J=q.width).height(K=q.height),c.add(h).add(d).css({left:0,top:0}),h.width(n(J-h.outerWidth()+h.innerWidth(),0)).height(n(K-h.outerHeight()+h.innerHeight(),0)),e(p[0]).css({left:m,top:g,width:q.x1,height:w}),e(p[1]).css({left:m+q.x1,top:g,width:J,height:q.y1}),e(p[2]).css({left:m+q.x2,top:g,width:b-q.x2,height:w}),e(p[3]).css({left:m+q.x1,top:g+q.y2,width:J,height:w-q.y2}),J-=d.outerWidth(),K-=d.outerHeight();switch(d.length){case 8:e(d[4]).css({left:J>>1}),e(d[5]).css({left:J,top:K>>1}),e(d[6]).css({left:J>>1,top:K}),e(d[7]).css({top:K>>1});case 4:d.slice(1,3).css({left:J}),d.slice(2,4).css({top:K})}t!==!1&&(e.imgAreaSelect.onKeyPress!=St&&e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress),u.keys&&e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=St)),Nt&&h.outerWidth()-h.innerWidth()==2&&(h.css("margin",0),setTimeout(function(){h.css("margin","auto")},0))}function ut(e){st(),ot(e),B=G(q.x1),j=Y(q.y1),F=G(q.x2),I=Y(q.y2)}function at(e,t){u.fadeSpeed?e.fadeOut(u.fadeSpeed,t):e.hide()}function ft(e){var t=Z(tt(e))-q.x1,n=et(nt(e))-q.y1;Q||(st(),Q=!0,l.one("mouseout",function(){Q=!1})),A="",u.resizable&&(n<=u.resizeMargin?A="n":n>=q.height-u.resizeMargin&&(A="s"),t<=u.resizeMargin?A+="w":t>=q.width-u.resizeMargin&&(A+="e")),l.css("cursor",A?A+"-resize":u.movable?"move":""),v&&v.toggle()}function lt(t){e("body").css("cursor",""),(u.autoHide||q.width*q.height==0)&&at(l.add(p),function(){e(this).hide()}),e(document).unbind("mousemove",dt),l.mousemove(ft),u.onSelectEnd(o,rt())}function ct(t){return t.which!=1?!1:(st(),A?(e("body").css("cursor",A+"-resize"),B=G(q[/w/.test(A)?"x2":"x1"]),j=Y(q[/n/.test(A)?"y2":"y1"]),e(document).mousemove(dt).one("mouseup",lt),l.unbind("mousemove",ft)):u.movable?(N=m+q.x1-tt(t),C=g+q.y1-nt(t),l.unbind("mousemove",ft),e(document).mousemove(mt).one("mouseup",function(){u.onSelectEnd(o,rt()),e(document).unbind("mousemove",mt),l.mousemove(ft)})):a.mousedown(t),!1)}function ht(e){P&&(e?(F=n(m,r(m+b,B+t(I-j)*P*(F>B||-1))),I=i(n(g,r(g+w,j+t(F-B)/P*(I>j||-1)))),F=i(F)):(I=n(g,r(g+w,j+t(F-B)/P*(I>j||-1))),F=i(n(m,r(m+b,B+t(I-j)*P*(F>B||-1)))),I=i(I)))}function pt(){B=r(B,m+b),j=r(j,g+w),t(F-B)<O&&(F=B-O*(F<B||-1),F<m?B=m+O:F>m+b&&(B=m+b-O)),t(I-j)<M&&(I=j-M*(I<j||-1),I<g?j=g+M:I>g+w&&(j=g+w-M)),F=n(m,r(F,m+b)),I=n(g,r(I,g+w)),ht(t(F-B)<t(I-j)*P),t(F-B)>_&&(F=B-_*(F<B||-1),ht()),t(I-j)>D&&(I=j-D*(I<j||-1),ht(!0)),q={x1:Z(r(B,F)),x2:Z(n(B,F)),y1:et(r(j,I)),y2:et(n(j,I)),width:t(F-B),height:t(I-j)},ot(),u.onSelectChange(o,rt())}function dt(e){return F=/w|e|^$/.test(A)||P?tt(e):G(q.x2),I=/n|s|^$/.test(A)||P?nt(e):Y(q.y2),pt(),!1}function vt(t,n){F=(B=t)+q.width,I=(j=n)+q.height,e.extend(q,{x1:Z(B),y1:et(j),x2:Z(F),y2:et(I)}),ot(),u.onSelectChange(o,rt())}function mt(e){return B=n(m,r(N+tt(e),m+b-q.width)),j=n(g,r(C+nt(e),g+w-q.height)),vt(B,j),e.preventDefault(),!1}function gt(){e(document).unbind("mousemove",gt),st(),F=B,I=j,pt(),A="",p.is(":visible")||l.add(p).hide().fadeIn(u.fadeSpeed||0),H=!0,e(document).unbind("mouseup",yt).mousemove(dt).one("mouseup",lt),l.unbind("mousemove",ft),u.onSelectStart(o,rt())}function yt(){e(document).unbind("mousemove",gt).unbind("mouseup",yt),at(l.add(p)),it(Z(B),et(j),Z(B),et(j)),this instanceof e.imgAreaSelect||(u.onSelectChange(o,rt()),u.onSelectEnd(o,rt()))}function bt(t){return t.which!=1||p.is(":animated")?!1:(st(),N=B=tt(t),C=j=nt(t),e(document).mousemove(gt).mouseup(yt),!1)}function wt(){ut(!1)}function Et(){f=!0,Tt(u=e.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},u)),l.add(p).css({visibility:""}),u.show&&(H=!0,st(),ot(),l.add(p).hide().fadeIn(u.fadeSpeed||0)),setTimeout(function(){u.onInit(o,rt())},0)}function xt(e,t){for(var n in t)u[n]!==undefined&&e.css(t[n],u[n])}function Tt(t){t.parent&&(E=e(t.parent)).append(l.add(p)),e.extend(u,t),st();if(t.handles!=null){d.remove(),d=e([]),X=t.handles?t.handles=="corners"?4:8:0;while(X--)d=d.add(s());d.addClass(u.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:x+1||1}),!parseInt(d.css("width"))>=0&&d.width(5).height(5),(V=u.borderWidth)&&d.css({borderWidth:V,borderStyle:"solid"}),xt(d,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}k=u.imageWidth/b||1,L=u.imageHeight/w||1,t.x1!=null&&(it(t.x1,t.y1,t.x2,t.y2),t.show=!t.hide),t.keys&&(u.keys=e.extend({shift:1,ctrl:"resize"},t.keys)),p.addClass(u.classPrefix+"-outer"),c.addClass(u.classPrefix+"-selection");for(X=0;X++<4;)e(h[X-1]).addClass(u.classPrefix+"-border"+X);xt(c,{selectionColor:"background-color",selectionOpacity:"opacity"}),xt(h,{borderOpacity:"opacity",borderWidth:"border-width"}),xt(p,{outerColor:"background-color",outerOpacity:"opacity"}),(V=u.borderColor1)&&e(h[0]).css({borderStyle:"solid",borderColor:V}),(V=u.borderColor2)&&e(h[1]).css({borderStyle:"dashed",borderColor:V}),l.append(c.add(h).add(v)).append(d),Nt&&((V=(p.css("filter")||"").match(/opacity=(\d+)/))&&p.css("opacity",V[1]/100),(V=(h.css("filter")||"").match(/opacity=(\d+)/))&&h.css("opacity",V[1]/100)),t.hide?at(l.add(p)):t.show&&f&&(H=!0,l.add(p).fadeIn(u.fadeSpeed||0),ut()),P=(W=(u.aspectRatio||"").split(/:/))[0]/W[1],a.add(p).unbind("mousedown",bt);if(u.disable||u.enable===!1)l.unbind("mousemove",ft).unbind("mousedown",ct),e(window).unbind("resize",wt);else{if(u.enable||u.disable===!1)(u.resizable||u.movable)&&l.mousemove(ft).mousedown(ct),e(window).resize(wt);u.persistent||a.add(p).mousedown(bt)}u.enable=u.disable=undefined}var a=e(o),f,l=s(),c=s(),h=s().add(s()).add(s()).add(s()),p=s().add(s()).add(s()).add(s()),d=e([]),v,m,g,y={left:0,top:0},b,w,E,S={left:0,top:0},x=0,T="absolute",N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q={x1:0,y1:0,x2:0,y2:0,width:0,height:0},R=document.documentElement,U=navigator.userAgent,z,W,X,V,J,K,Q,St=function(e){var t=u.keys,i,s,o=e.keyCode;i=!isNaN(t.alt)&&(e.altKey||e.originalEvent.altKey)?t.alt:!isNaN(t.ctrl)&&e.ctrlKey?t.ctrl:!isNaN(t.shift)&&e.shiftKey?t.shift:isNaN(t.arrows)?10:t.arrows;if(t.arrows=="resize"||t.shift=="resize"&&e.shiftKey||t.ctrl=="resize"&&e.ctrlKey||t.alt=="resize"&&(e.altKey||e.originalEvent.altKey)){switch(o){case 37:i=-i;case 39:s=n(B,F),B=r(B,F),F=n(s+i,B),ht();break;case 38:i=-i;case 40:s=n(j,I),j=r(j,I),I=n(s+i,j),ht(!0);break;default:return}pt()}else{B=r(B,F),j=r(j,I);switch(o){case 37:vt(n(B-i,m),j);break;case 38:vt(B,n(j-i,g));break;case 39:vt(B+r(i,b-Z(F)),j);break;case 40:vt(B,j+r(i,w-et(I)));break;default:return}}return!1};this.remove=function(){Tt({disable:!0}),l.add(p).remove()},this.getOptions=function(){return u},this.setOptions=Tt,this.getSelection=rt,this.setSelection=it,this.cancelSelection=yt,this.update=ut;var Nt=(/msie ([\w.]+)/i.exec(U)||[])[1],Ct=/opera/i.test(U),kt=/webkit/i.test(U)&&!/chrome/i.test(U);z=a;while(z.length)x=n(x,isNaN(z.css("z-index"))?x:z.css("z-index")),z.css("position")=="fixed"&&(T="fixed"),z=z.parent(":not(body)");x=u.zIndex||x,Nt&&a.attr("unselectable","on"),e.imgAreaSelect.keyPress=Nt||kt?"keydown":"keypress",Ct&&(v=s().css({width:"100%",height:"100%",position:"absolute",zIndex:x+2||2})),l.add(p).css({visibility:"hidden",position:T,overflow:"hidden",zIndex:x||"0"}),l.css({zIndex:x+2||2}),c.add(h).css({position:"absolute",fontSize:0}),o.complete||o.readyState=="complete"||!a.is("img")?Et():a.one("load",Et),!f&&Nt&&Nt>=7&&(o.src=o.src)},e.fn.imgAreaSelect=function(t){return t=t||{},this.each(function(){e(this).data("imgAreaSelect")?t.remove?(e(this).data("imgAreaSelect").remove(),e(this).removeData("imgAreaSelect")):e(this).data("imgAreaSelect").setOptions(t):t.remove||(t.enable===undefined&&t.disable===undefined&&(t.enable=!0),e(this).data("imgAreaSelect",new e.imgAreaSelect(this,t)))}),t.instance?e(this).data("imgAreaSelect"):this}})(jQuery),jQuery.fn.farbtastic=function(e){return $.farbtastic(this,e),this},jQuery.farbtastic=function(e,t){var e=$(e).get(0);return e.farbtastic||(e.farbtastic=new jQuery._farbtastic(e,t))},jQuery._farbtastic=function(e,t){var n=this;$(e).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var r=$(".farbtastic",e);n.wheel=$(".wheel",e).get(0),n.radius=84,n.square=100,n.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",r).each(function(){if(this.currentStyle.backgroundImage!="none"){var e=this.currentStyle.backgroundImage;e=this.currentStyle.backgroundImage.substring(5,e.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+e+"')"})}}),n.linkTo=function(e){typeof n.callback=="object"&&$(n.callback).unbind("keyup",n.updateValue),n.color=null;if(typeof e=="function")n.callback=e;else if(typeof e=="object"||typeof e=="string")n.callback=$(e),n.callback.bind("keyup",n.updateValue),n.callback.get(0).value&&n.setColor(n.callback.get(0).value);return this},n.updateValue=function(e){this.value&&this.value!=n.color&&n.setColor(this.value)},n.setColor=function(e){var t=n.unpack(e);return n.color!=e&&t&&(n.color=e,n.rgb=t,n.hsl=n.RGBToHSL(n.rgb),n.updateDisplay()),this},n.setHSL=function(e){return n.hsl=e,n.rgb=n.HSLToRGB(e),n.color=n.pack(n.rgb),n.updateDisplay(),this},n.widgetCoords=function(e){var t,r,i=e.target||e.srcElement,s=n.wheel;if(typeof e.offsetX!="undefined"){var o={x:e.offsetX,y:e.offsetY},u=i;while(u)u.mouseX=o.x,u.mouseY=o.y,o.x+=u.offsetLeft,o.y+=u.offsetTop,u=u.offsetParent;var u=s,a={x:0,y:0};while(u){if(typeof u.mouseX!="undefined"){t=u.mouseX-a.x,r=u.mouseY-a.y;break}a.x+=u.offsetLeft,a.y+=u.offsetTop,u=u.offsetParent}u=i;while(u)u.mouseX=undefined,u.mouseY=undefined,u=u.offsetParent}else{var o=n.absolutePosition(s);t=(e.pageX||0*(e.clientX+$("html").get(0).scrollLeft))-o.x,r=(e.pageY||0*(e.clientY+$("html").get(0).scrollTop))-o.y}return{x:t-n.width/2,y:r-n.width/2}},n.mousedown=function(e){document.dragging||($(document).bind("mousemove",n.mousemove).bind("mouseup",n.mouseup),document.dragging=!0);var t=n.widgetCoords(e);return n.circleDrag=Math.max(Math.abs(t.x),Math.abs(t.y))*2>n.square,n.mousemove(e),!1},n.mousemove=function(e){var t=n.widgetCoords(e);if(n.circleDrag){var r=Math.atan2(t.x,-t.y)/6.28;r<0&&(r+=1),n.setHSL([r,n.hsl[1],n.hsl[2]])}else{var i=Math.max(0,Math.min(1,-(t.x/n.square)+.5)),s=Math.max(0,Math.min(1,-(t.y/n.square)+.5));n.setHSL([n.hsl[0],i,s])}return!1},n.mouseup=function(){$(document).unbind("mousemove",n.mousemove),$(document).unbind("mouseup",n.mouseup),document.dragging=!1},n.updateDisplay=function(){var e=n.hsl[0]*6.28;$(".h-marker",r).css({left:Math.round(Math.sin(e)*n.radius+n.width/2)+"px",top:Math.round(-Math.cos(e)*n.radius+n.width/2)+"px"}),$(".sl-marker",r).css({left:Math.round(n.square*(.5-n.hsl[1])+n.width/2)+"px",top:Math.round(n.square*(.5-n.hsl[2])+n.width/2)+"px"}),$(".color",r).css("backgroundColor",n.pack(n.HSLToRGB([n.hsl[0],1,.5]))),typeof n.callback=="object"?($(n.callback).css({backgroundColor:n.color,color:n.hsl[2]>.5?"#000":"#fff"}),$(n.callback).each(function(){this.value&&this.value!=n.color&&(this.value=n.color)})):typeof n.callback=="function"&&n.callback.call(n,n.color)},n.absolutePosition=function(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var r=n.absolutePosition(e.offsetParent);t.x+=r.x,t.y+=r.y}return t},n.pack=function(e){var t=Math.round(e[0]*255),n=Math.round(e[1]*255),r=Math.round(e[2]*255);return"#"+(t<16?"0":"")+t.toString(16)+(n<16?"0":"")+n.toString(16)+(r<16?"0":"")+r.toString(16)},n.unpack=function(e){if(e.length==7)return[parseInt("0x"+e.substring(1,3))/255,parseInt("0x"+e.substring(3,5))/255,parseInt("0x"+e.substring(5,7))/255];if(e.length==4)return[parseInt("0x"+e.substring(1,2))/15,parseInt("0x"+e.substring(2,3))/15,parseInt("0x"+e.substring(3,4))/15]},n.HSLToRGB=function(e){var t,n,r,i,s,o=e[0],u=e[1],a=e[2];return n=a<=.5?a*(u+1):a+u-a*u,t=a*2-n,[this.hueToRGB(t,n,o+.33333),this.hueToRGB(t,n,o),this.hueToRGB(t,n,o-.33333)]},n.hueToRGB=function(e,t,n){return n=n<0?n+1:n>1?n-1:n,n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(.66666-n)*6:e},n.RGBToHSL=function(e){var t,n,r,i,s,o,u=e[0],a=e[1],f=e[2];return t=Math.min(u,Math.min(a,f)),n=Math.max(u,Math.max(a,f)),r=n-t,o=(t+n)/2,s=0,o>0&&o<1&&(s=r/(o<.5?2*o:2-2*o)),i=0,r>0&&(n==u&&n!=a&&(i+=(a-f)/r),n==a&&n!=f&&(i+=2+(f-u)/r),n==f&&n!=u&&(i+=4+(u-a)/r),i/=6),[i,s,o]},$("*",r).mousedown(n.mousedown),n.setColor("#000000"),t&&n.linkTo(t)};